<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mistake Tracker</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>Mistake Tracker</h1>
            <p class="subtitle">Track your mistakes, learn from them, improve</p>
        </header>

        <!-- Tab Navigation -->
        <nav class="tab-nav">
            <button class="tab-btn active" data-tab="mistakes-tab">Your Mistakes</button>
            <button class="tab-btn" data-tab="add-tab">Add New Mistake</button>
        </nav>

        <!-- Tab Content: Your Mistakes -->
        <div id="mistakes-tab" class="tab-content active">
            <!-- Filters Section -->
            <section class="filters-section">
                <div class="filter-group">
                    <label for="filter-topic">Topic:</label>
                    <select id="filter-topic">
                        <option value="">All Topics</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="filter-type">Mistake Type:</label>
                    <select id="filter-type">
                        <option value="">All Types</option>
                        {% for mt in mistake_types %}
                        <option value="{{ mt }}">{{ mt }}</option>
                        {% endfor %}
                    </select>
                </div>
                <button id="clear-filters" class="btn btn-secondary">Clear Filters</button>
                <button id="toggle-analytics" class="btn btn-secondary">Show Analytics</button>
            </section>

            <!-- Analytics Section (hidden by default) -->
            <section id="analytics-section" class="analytics-section hidden">
                <div class="analytics-cards">
                    <div class="stat-card">
                        <span class="stat-value" id="total-mistakes">0</span>
                        <span class="stat-label">Total Mistakes</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="most-common-type">-</span>
                        <span class="stat-label">Most Common Type</span>
                    </div>
                </div>
                <div class="charts-container">
                    <div class="chart-wrapper">
                        <h3>Mistakes by Type</h3>
                        <canvas id="type-chart"></canvas>
                    </div>
                    <div class="chart-wrapper">
                        <h3>Mistakes by Topic</h3>
                        <canvas id="topic-chart"></canvas>
                    </div>
                </div>
            </section>

            <!-- Mistakes Table -->
            <section class="table-section">
                <h2>Your Mistakes <span id="mistake-count" class="count-badge">0</span></h2>
                <div class="table-container">
                    <table id="mistakes-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Topic</th>
                                <th>Question</th>
                                <th>Solution</th>
                                <th>Type</th>
                                <th>Why It Happened</th>
                                <th>How to Avoid</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="mistakes-tbody">
                            <!-- Rows will be inserted here by JavaScript -->
                        </tbody>
                    </table>
                    <p id="no-data" class="no-data hidden">No mistakes recorded yet. Switch to "Add New Mistake" tab to add your first one!</p>
                </div>
            </section>
        </div>

        <!-- Tab Content: Add New Mistake -->
        <div id="add-tab" class="tab-content">
            <section class="add-section">
                <h2>Add New Mistake</h2>
                <form id="add-form">
                    <!-- Step 1: Images -->
                    <div class="form-row">
                        <div class="form-group image-paste-area" id="image-paste-area">
                            <label>Step 1: Paste Question Image (Ctrl+V)</label>
                            <div class="paste-zone" id="paste-zone">
                                <span class="paste-hint">Click here and paste image (Ctrl+V)</span>
                                <img id="preview-image" class="hidden" alt="Question preview">
                                <button type="button" id="clear-image" class="btn-clear hidden">Clear</button>
                            </div>
                            <input type="hidden" id="new-image" value="">
                        </div>
                        <div class="form-group image-paste-area" id="solution-paste-area">
                            <label>Solution Image (Optional - Ctrl+V)</label>
                            <div class="paste-zone" id="solution-paste-zone">
                                <span class="paste-hint">Click here and paste image (Ctrl+V)</span>
                                <img id="solution-preview-image" class="hidden" alt="Solution preview">
                                <button type="button" id="clear-solution-image" class="btn-clear hidden">Clear</button>
                            </div>
                            <input type="hidden" id="new-solution-image" value="">
                        </div>
                    </div>

                    <!-- Step 2: Topic and Type -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="new-topic">Step 2: Topic *</label>
                            <input type="text" id="new-topic" placeholder="e.g., Calculus - Derivatives" required>
                        </div>
                        <div class="form-group">
                            <label for="new-type">Step 3: Mistake Type *</label>
                            <select id="new-type" required>
                                {% for mt in mistake_types %}
                                <option value="{{ mt }}">{{ mt }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <!-- Step 3: Analysis -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="new-why">Step 4: Why did this mistake happen? *</label>
                            <textarea id="new-why" placeholder="e.g., Didn't understand the chain rule..." required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="new-avoid">Step 5: How to avoid it next time? *</label>
                            <textarea id="new-avoid" placeholder="e.g., Practice more chain rule problems..." required></textarea>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary btn-large">Add Mistake</button>
                </form>
            </section>
        </div>
    </div>

    <!-- Image Modal -->
    <div id="image-modal" class="modal hidden">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <img id="modal-image" src="" alt="Full size question">
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="edit-modal" class="modal hidden">
        <div class="modal-content edit-modal-content">
            <span class="modal-close">&times;</span>
            <h2>Edit Mistake</h2>
            <form id="edit-form">
                <input type="hidden" id="edit-id">
                <div class="form-row">
                    <div class="form-group image-paste-area">
                        <label>Question Image (Ctrl+V to paste new)</label>
                        <div class="paste-zone" id="edit-paste-zone">
                            <span class="paste-hint">Click here and paste image (Ctrl+V)</span>
                            <img id="edit-preview-image" class="hidden" alt="Question preview">
                            <button type="button" id="edit-clear-image" class="btn-clear hidden">Clear</button>
                        </div>
                        <input type="hidden" id="edit-image" value="">
                    </div>
                    <div class="form-group image-paste-area">
                        <label>Solution Image (Optional - Ctrl+V)</label>
                        <div class="paste-zone" id="edit-solution-paste-zone">
                            <span class="paste-hint">Click here and paste image (Ctrl+V)</span>
                            <img id="edit-solution-preview-image" class="hidden" alt="Solution preview">
                            <button type="button" id="edit-clear-solution-image" class="btn-clear hidden">Clear</button>
                        </div>
                        <input type="hidden" id="edit-solution-image" value="">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="edit-topic">Topic</label>
                        <input type="text" id="edit-topic" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-type">Mistake Type</label>
                        <select id="edit-type" required>
                            {% for mt in mistake_types %}
                            <option value="{{ mt }}">{{ mt }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="edit-why">Why did this mistake happen?</label>
                        <textarea id="edit-why" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="edit-avoid">How to avoid it next time?</label>
                        <textarea id="edit-avoid" required></textarea>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                    <button type="button" class="btn btn-secondary" id="cancel-edit">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="modal hidden">
        <div class="modal-content delete-modal-content">
            <h2>Delete Mistake?</h2>
            <p>Are you sure you want to delete this mistake? This cannot be undone.</p>
            <div class="form-actions">
                <button type="button" class="btn btn-danger" id="confirm-delete">Delete</button>
                <button type="button" class="btn btn-secondary" id="cancel-delete">Cancel</button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
